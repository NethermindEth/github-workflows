# Promotes Docker images between environments in JFrog Artifactory
# Features:
# - Promotes from dev to staging, or staging to prod
# - Maintains build provenance attestation
# - Supports multiple tag promotion
name: Docker Image Promotion

on:
  workflow_dispatch:
    inputs:
      target_env:
        description: 'Target environment to promote to'
        type: choice
        options: ['staging', 'prod']
        required: true
      tags:
        description: 'Tags to promote (comma-separated)'
        type: string
        required: true

permissions:
  id-token: write
  attestations: write
  contents: read

jobs:
  promote:
    uses: NethermindEth/github-workflows/.github/workflows/promote-docker.yaml@main
    with:
      # Required inputs
      target_env: ${{ inputs.target_env }}     # Target: 'staging' or 'prod'
      tags: ${{ inputs.tags }}                 # Example: 'v1.0.0,latest'

      # Optional inputs (with defaults shown)
      jfrog_url: 'nethermind.jfrog.io'
      image_name: '<repository-name>'
      login_with_oidc: false

    # Optional secrets - Deprecated
    # Use those secrets if you don't have the OIDC enabled yet
    secrets:
      artifactory_access_token: ${{ secrets.ARTIFACTORY_TOKEN }}     # JFrog access token
      artifactory_username: ${{ secrets.ARTIFACTORY_USERNAME }}      # Repository prefix, e.g. 'angkor'
